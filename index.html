<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Карточки для Instagram</title>
<style>

/* cyrillic */
@font-face {
  font-family: 'Montserrat';
  font-style: normal;
  font-weight: 300;
  font-display: swap;
  src: url(https://fonts.gstatic.com/s/montserrat/v18/JTURjIg1_i6t8kCHKm45_cJD3g3D_u50.woff2) format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}

/* latin */
@font-face {
  font-family: 'Montserrat';
  font-style: normal;
  font-weight: 300;
  font-display: swap;
  src: url(https://fonts.gstatic.com/s/montserrat/v18/JTURjIg1_i6t8kCHKm45_cJD3gnD_g.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: 'Courier New';
}

main {
	width: 100%;
	height: auto;
	display: flex;
	flex-direction: column;
	position: relative;
}

li {
	list-style-type: none;
}

h4 {
	font-size: 0.8rem;
	font-weight: 300;
}

.flex-container ul {
	width: 100%;
	height: 100%;
	display: flex;
	justify-content: space-evenly;
	align-items: center;
	text-align: center;
	flex-wrap: wrap;
	overflow: hidden;
}

.nav-panel-upper  {
	background-color: yellow;
	width: 100%;
	height: 25vh;
	position: sticky;
	top:  0;
	left: 0;
	z-index: 1000;
}


.nav-panel-middle {
	background-color: lightcoral;
	width: 100%;
	height: 35vh;
}

.nav-panel-middle ul li:first-child{
	flex:  2;
}

.nav-panel-middle ul li:nth-child(2){
	flex:  2;
}


textarea {
	width: 80%;
	height: 100px;
}

.nav-panel-lower {
	background-color: orange;
	width: 100%;
	height: 14vh;
}

.logo {
	width: 4rem;
	height: 4rem;
	border: 1px #000 solid;
}

.logo:hover{
	cursor: pointer;
}

.card {
	width: 100%;
	height:  auto;
	border: 2px #000 dotted;
	display: flex;
	justify-content: center;
	align-items: flex-start;
}

.logo-img {
	object-fit: contain;
	width: 100%;
	height: 100%;
}


canvas {
	transform: scale(0.9);
}



</style>

</head>
<body>
<main>
	<div class="nav-panel-upper flex-container"> 
		<ul> 
			<li> 
				<h4> Выбери цвет визитки </h4>
				<input type="color" id="colorSelector">
			 </li>

			 	<li> 
				<select id="postTypeSelector"> 
					<option value="Размер шрифта..." selected=true disabled=disabled> Тип поста </option>
					<option value="Сториз" > Сториз </option>
					<option value="Пост" > Пост </option>
				</select>
			 </li>

			 	<li> 
			 		<h4> Размер шрифта </h4>
				<input type="range" id="fontSizeSelector" min="0.3" max="1.8" step="0.1"> 
			 </li>

			 	<li> 
					<select id="fontFormatSelector"> 
					<option value="Тип начертания" selected=true disabled=disabled> Тип начертания</option>
					<option value="Обычный" > Обычный </option>
					<option value="С наклоном" > С наклоном </option>
					<option value="Жирный" > Жирный </option>
				</select>
			 </li>

			 	<li> 
					<h4> Расположение шапки по оси X</h4>
					<input type="range" id="hearderPosSwitcherX" min="0" step="1"> 	
			 </li>

			 	 	<li> 
					<h4> Расположение шапки по оси Y</h4>
					<input type="range" id="hearderPosSwitcherY" min="0"  step="1"> 	
			 </li>

			 		<li> 
					<h4> Расположение основного текста по оси X</h4>
					<input type="range" id="textPosSwitcherX" min="0" step="1"> 	
			 </li>

			 	 	<li> 
					<h4> Расположение основного текста по оси Y</h4>
					<input type="range" id="textPosSwitcherY" min="0" step="1"> 	
			 </li>
		</ul>
	</div>

	<div class="nav-panel-middle flex-container"> 
		<ul> 
			<li> 
				<h4> Цвет текста в шапке: </h4>
				<input type='color' id="headerTextColor">
				<br> <br>
				<h4> Текст для шапки: </h4> <textarea id="hearderText"></textarea>
				 </li>
			<li> 
				<h4> Цвет основного текста: </h4>
				<input type='color' id="mainTextColor">
				<br> <br>
				<h4> Основной текст: </h4> <textarea id="mainText"></textarea> 
			</li>
		</ul>	
	</div>

		<div class="nav-panel-lower flex-container"> 
		<ul> 
			<li> <h4> Выбери логотип: </h4> </li>
			<li> <div class="logo"> </div> </li>
			<li> <div class="logo"> </div> </li>
			<li> <div class="logo"> </div> </li>
			<li> <div class="logo"> </div> </li>
			<li> <div class="logo"> </div> </li>
			<li> <div class="logo"> </div> </li>
		</ul>
	<br> 
</div>
	<div class="card"> 
		<canvas></canvas>
	 </div>
</main>

<script type="text/javascript">
const upperNav = document.querySelector('.nav-panel-upper');
const main = document.querySelector('main');

Array.from(main.children).forEach((child,index)=> index%2 === 0 ? child.style.backgroundColor = '#d6d6d2' : child.style.backgroundColor = '#babab8');


window.onscroll = ()=> {
	if(document.documentElement.scrollTop > document.documentElement.clientHeight/2){
		upperNav.style.opacity = 0.6;
		Array.from(main.children).forEach((child,index) => index !== 0 && index !== 3 ? child.style.visibility = 'hidden' : null )
	} else {
		upperNav.style.opacity = 1;
		Array.from(main.children).forEach(child => child.style.visibility = 'visible');
	}
};



const route = 'imgs/';
const images = [`${route}lotus.png`, `${route}mental-health.png`, `${route}psychological-help.png`, `${route}psychology (4).png`, `${route}psychology.png`, `${route}yoga.png`];
const logoSelector = document.querySelectorAll('.logo');

Array.from(logoSelector).forEach((logo, index)=> {
	const img = new Image();
	img.src = images[index];
	img.setAttribute('class', 'logo-img');
	img.onload = ()=> {logo.appendChild(img)};
});

Array.from(logoSelector).forEach((logo, index, arr)=> logo.onclick = ()=> {
	logo.style.border = '2px blue dotted';
	selectedLogo = images[index];
	draw(mainTextPos.x, mainTextPos.y);
	arr.forEach((l, i)=> index !== i ? l.style.border = '1px #000 solid' : '2px blue dotted')
});

let selectedLogo = null;

const canvas = document.querySelector('canvas');
ctx = canvas.getContext('2d');

let canvasColor = '#000';
const colorSelector = document.querySelector('#colorSelector');
colorSelector.oninput = ()=> {canvasColor = colorSelector.value; draw(mainTextPos.x, mainTextPos.y)}

const canvasDims = {
	width: 420,
	height: 420
};

canvas.width = canvasDims.width;
canvas.height = canvasDims.height;


const postTypeSelector = document.querySelector('#postTypeSelector').onchange = (e)=> {
	switch(e.target.value){
		case 'Пост':
		canvasDims.height = 420;
		draw(mainTextPos.x, mainTextPos.y)
		break

		case 'Сториз':
		canvasDims.height = 700;
		draw(mainTextPos.x, mainTextPos.y)
		break

	}
};

let fontSize = 'calc(1.3rem + 1vmin)';
const fontSizeSelector = document.querySelector('#fontSizeSelector').onchange = (e)=> {fontSize = `calc(${e.target.value}rem + 1vmin)`; draw(mainTextPos.x, mainTextPos.y)};

let fontFormat = 'normal';
const fontFormatSelector = document.querySelector('#fontFormatSelector').onchange = (e)=>{
	switch(e.target.value){
		case 'Обычный':
		fontFormat = 'normal';
		draw(mainTextPos.x, mainTextPos.y);
		break

		case 'С наклоном':
		fontFormat = 'Italic';
		draw(mainTextPos.x, mainTextPos.y);
		break

		case 'Жирный':
		fontFormat = 'bold';
		draw(mainTextPos.x, mainTextPos.y);
		break
	}
};

let headerPos = {
	x: canvas.width/2,
	y: 80
};

const hearderPosSwitcher = {
	xAxis: document.querySelector('#hearderPosSwitcherX'),
	yAxis: document.querySelector('#hearderPosSwitcherY'),
} 


hearderPosSwitcher.xAxis.setAttribute('max', canvas.width);
hearderPosSwitcher.yAxis.setAttribute('max', canvas.height);


hearderPosSwitcher.xAxis.onchange = (e)=> {headerPos.x = Number(e.target.value); draw(mainTextPos.x, mainTextPos.y)};
hearderPosSwitcher.yAxis.onchange = (e)=> {headerPos.y = Number(e.target.value); draw(mainTextPos.x, mainTextPos.y)};


let mainTextPos = {
	x: 10,
	y: 30
};


const textPosSwitcher = {
	xAxis: document.querySelector('#textPosSwitcherX'),
	yAxis: document.querySelector('#textPosSwitcherY'),
};

textPosSwitcher.xAxis.setAttribute('max', canvas.width);
textPosSwitcher.yAxis.setAttribute('max', canvas.height);

textPosSwitcher.xAxis.onchange = (e)=> {mainTextPos.x = Number(e.target.value); draw(mainTextPos.x, mainTextPos.y)};
textPosSwitcher.yAxis.onchange = (e)=> {mainTextPos.y = Number(e.target.value); draw(mainTextPos.x, mainTextPos.y)};



let headerFontColor = '#000';
const headerTextColor = document.querySelector('#headerTextColor');
headerTextColor.oninput = ()=> {
	headerFontColor = headerTextColor.value;
	draw(mainTextPos.x, mainTextPos.y);
}


let mainFontColor = '#fff';
const mainTextColor = document.querySelector('#mainTextColor');
mainTextColor.oninput = ()=> {
	mainFontColor = mainTextColor.value;
	draw(mainTextPos.x, mainTextPos.y);
};


let headerContent = '';
const hearderText = document.querySelector('#hearderText').onkeyup = (e)=> {headerContent = e.target.value; draw(mainTextPos.x, mainTextPos.y)}


let textContent = '';
const mainText = document.querySelector('#mainText');

mainText.onkeyup = (e)=> {

textContent = e.target.value; 
draw(mainTextPos.x, mainTextPos.y)
};

let selected = '';
mainText.onselect = (e)=>{
	selected = e.target.value.substring(e.target.selectionStart, e.target.selectionEnd);
	console.log(selected)
	draw(mainTextPos.x, mainTextPos.y)
}




const draw = (mainTextPosX, mainTextPosY)=>{
	
	//set canvas dims:
	canvas.width = canvasDims.width;
	canvas.height = canvasDims.height;

	//reset text pos:
	hearderPosSwitcher.yAxis.setAttribute('max', canvas.height);
	textPosSwitcher.yAxis.setAttribute('max', canvas.height);

	//reset text pos:
	mainTextPos.x = mainTextPosX;
	mainTextPos.y = mainTextPosY;

	
		
	ctx.clearRect(0,0,canvas.width, canvas.height);

	//set canvas color:
	ctx.beginPath();
	ctx.fillStyle = canvasColor;
	ctx.fillRect(0,0, canvas.width, canvas.height);
	ctx.closePath();

	//add header content
	ctx.beginPath();
	ctx.fillStyle = headerFontColor;
	
	
	ctx.font = 'bold calc(2.2rem + 1vmin) Montserrat';
	ctx.lineWidth = 1.8;
	ctx.fillText(headerContent, headerPos.x, headerPos.y);
	ctx.closePath();

	//add main text content
	ctx.beginPath();
	ctx.fillStyle = mainFontColor;
	ctx.closePath();

	const lineHeight = 30;


	//split text into words by line breaks if any:
	const words = textContent.split('\n'); 
		words.forEach((word, index) => {
			ctx.font = `${fontFormat} ${fontSize} Montserrat`;
			ctx.fillText(word, mainTextPos.x, mainTextPos.y + (index * lineHeight));
			ctx.closePath();
		});

	

	//draw logo
	if(selectedLogo !== null){
		const img = new Image();
		img.src = selectedLogo;
		img.onload = ()=> ctx.drawImage(img, canvas.width-72, canvas.height-72, 62,62);
	}


	//preventing text sliding beyound the box
	 mainTextPos.y =  mainTextPos.y > canvas.height ? 30 : mainTextPos.y;
}









</script>

</body>
</html>